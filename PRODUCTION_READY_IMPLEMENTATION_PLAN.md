# AIè£œåŠ©é‡‘ç”³è«‹ã‚·ã‚¹ãƒ†ãƒ  - æœ¬ç•ªå®Ÿè£…è¨ˆç”»æ›¸

## ğŸ¯ ç›®æ¨™
å®Ÿéš›ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒæœ¬ç•ªç’°å¢ƒã§è£œåŠ©é‡‘ç”³è«‹æ›¸ã‚’ä½œæˆã§ãã‚‹ãƒ¬ãƒ™ãƒ«ã¾ã§ã‚·ã‚¹ãƒ†ãƒ ã‚’å®Œæˆã•ã›ã‚‹

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æ§‹æˆ

### ç¾åœ¨ã®æ§‹æˆ
- **Backend**: Express.js + PostgreSQL + Redis
- **Frontend**: Next.js 14
- **AI**: OpenAI + Anthropic Claude
- **Storage**: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚·ã‚¹ãƒ†ãƒ 

### ç§»è¡Œå¾Œã®æ§‹æˆï¼ˆSupabase + Vercelï¼‰
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Vercel Edge                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚   Next.js 14    â”‚    â”‚  Vercel Functions  â”‚     â”‚
â”‚  â”‚  (Frontend)     â”‚    â”‚   (API Routes)     â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚           â”‚                         â”‚                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                         â”‚
            â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Supabase                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚  PostgreSQL  â”‚  â”‚   Storage    â”‚  â”‚ Realtime  â”‚ â”‚
â”‚  â”‚  (Database)  â”‚  â”‚   (Files)    â”‚  â”‚ (WebSocket)â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Auth     â”‚  â”‚   Vector DB  â”‚  â”‚   Edge    â”‚ â”‚
â”‚  â”‚ (èªè¨¼ç®¡ç†)   â”‚  â”‚  (AIåŸ‹è¾¼ã¿)  â”‚  â”‚ Functions â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                         â”‚
            â–¼                         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   External APIs     â”‚    â”‚       AI APIs           â”‚
â”‚ ãƒ»æ³•äººç•ªå·API       â”‚    â”‚ ãƒ»Gemini API (ç„¡æ–™æ )   â”‚
â”‚ ãƒ»e-Gov API         â”‚    â”‚ ãƒ»OpenAI API            â”‚
â”‚ ãƒ»çµŒæ¸ˆã‚»ãƒ³ã‚µã‚¹API   â”‚    â”‚ ãƒ»Anthropic Claude      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ“‹ å®Ÿè£…ã‚¿ã‚¹ã‚¯

### Phase 1: åŸºç›¤ç§»è¡Œï¼ˆ1-2é€±é–“ï¼‰

#### 1.1 Supabase ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```typescript
// supabase/migrations/001_initial_schema.sql
-- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE users (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  email TEXT UNIQUE NOT NULL,
  company_name TEXT,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- ç”³è«‹æ›¸ãƒ†ãƒ¼ãƒ–ãƒ«
CREATE TABLE applications (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
  user_id UUID REFERENCES users(id) ON DELETE CASCADE,
  subsidy_type TEXT NOT NULL,
  status TEXT DEFAULT 'draft',
  data JSONB NOT NULL,
  created_at TIMESTAMPTZ DEFAULT NOW()
);

-- Row Level Security
ALTER TABLE applications ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Users can only see their own applications" 
ON applications FOR ALL 
USING (auth.uid() = user_id);
```

#### 1.2 Vercel Functions ç§»è¡Œ
```typescript
// app/api/subsidies/create/route.ts
import { createClient } from '@supabase/supabase-js'
import { GoogleGenerativeAI } from '@google/generative-ai'

const supabase = createClient(
  process.env.NEXT_PUBLIC_SUPABASE_URL!,
  process.env.SUPABASE_SERVICE_KEY!
)

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY!)

export async function POST(request: Request) {
  const { userId, subsidyType, formData } = await request.json()
  
  // Gemini APIã§ç”³è«‹æ›¸ç”Ÿæˆ
  const model = genAI.getGenerativeModel({ model: "gemini-pro" })
  const result = await model.generateContent(
    `ä»¥ä¸‹ã®æƒ…å ±ã‹ã‚‰${subsidyType}ã®ç”³è«‹æ›¸ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„: ${JSON.stringify(formData)}`
  )
  
  // Supabaseã«ä¿å­˜
  const { data, error } = await supabase
    .from('applications')
    .insert({
      user_id: userId,
      subsidy_type: subsidyType,
      data: {
        ...formData,
        generated_content: result.response.text()
      }
    })
    .select()
    .single()
    
  return Response.json({ data, error })
}
```

### Phase 2: å¤–éƒ¨APIé€£æºå®Ÿè£…ï¼ˆ1é€±é–“ï¼‰

#### 2.1 ç„¡æ–™APIçµ±åˆ
```typescript
// app/api/external/company-info/route.ts
export async function GET(request: Request) {
  const { searchParams } = new URL(request.url)
  const corporateNumber = searchParams.get('corporateNumber')
  
  // æ³•äººç•ªå·APIï¼ˆç„¡æ–™ï¼‰
  const houjinResponse = await fetch(
    `https://api.houjin-bangou.nta.go.jp/4/num?id=${corporateNumber}&type=12`
  )
  
  // e-Gov APIï¼ˆç„¡æ–™ï¼‰
  const eGovResponse = await fetch(
    `https://api2.e-gov.go.jp/external/api/search`,
    {
      headers: { 'X-API-KEY': process.env.EGOV_API_KEY }
    }
  )
  
  // çµŒæ¸ˆã‚»ãƒ³ã‚µã‚¹APIï¼ˆç„¡æ–™ï¼‰
  const estatResponse = await fetch(
    `https://api.e-stat.go.jp/rest/3.0/app/json/getStatsData?appId=${process.env.ESTAT_APP_ID}`
  )
  
  return Response.json({
    houjin: await houjinResponse.json(),
    egov: await eGovResponse.json(),
    estat: await estatResponse.json()
  })
}
```

#### 2.2 å®Ÿãƒ‡ãƒ¼ã‚¿å–å¾—ã‚µãƒ¼ãƒ“ã‚¹
```typescript
// services/realDataService.ts
export class RealDataService {
  // å®Ÿéš›ã®è£œåŠ©é‡‘å…¬å‹Ÿè¦é ˜ã‚’å–å¾—
  async fetchSubsidyGuidelines(subsidyType: string) {
    const guidelines = await supabase
      .from('subsidy_guidelines')
      .select('*')
      .eq('type', subsidyType)
      .single()
      
    return guidelines.data
  }
  
  // å®Ÿéš›ã®ç”³è«‹æ›¸ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’å–å¾—
  async fetchApplicationTemplate(subsidyType: string) {
    const { data } = await supabase.storage
      .from('templates')
      .download(`${subsidyType}_template.pdf`)
      
    return data
  }
  
  // ä¼æ¥­ã®å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’çµ±åˆ
  async aggregateCompanyData(corporateNumber: string) {
    const [houjin, financial, patents] = await Promise.all([
      this.fetchHoujinData(corporateNumber),
      this.fetchFinancialData(corporateNumber),
      this.fetchPatentData(corporateNumber)
    ])
    
    return { houjin, financial, patents }
  }
}
```

### Phase 3: Gemini APIçµ±åˆï¼ˆ3-4æ—¥ï¼‰

#### 3.1 Geminiè¨­å®š
```typescript
// lib/ai/gemini.ts
import { GoogleGenerativeAI } from '@google/generative-ai'

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY!)

export const geminiModels = {
  // ãƒ†ã‚­ã‚¹ãƒˆç”Ÿæˆï¼ˆç„¡æ–™æ : 60 requests/minuteï¼‰
  text: genAI.getGenerativeModel({ model: "gemini-pro" }),
  
  // ç”»åƒè§£æï¼ˆç„¡æ–™æ : 60 requests/minuteï¼‰
  vision: genAI.getGenerativeModel({ model: "gemini-pro-vision" }),
  
  // åŸ‹ã‚è¾¼ã¿ç”Ÿæˆ
  embedding: genAI.getGenerativeModel({ model: "embedding-001" })
}

// ç”³è«‹æ›¸ç”Ÿæˆé–¢æ•°
export async function generateApplication(
  subsidyType: string,
  companyData: any,
  requirements: any
) {
  const prompt = `
ã‚ãªãŸã¯è£œåŠ©é‡‘ç”³è«‹æ›¸ä½œæˆã®å°‚é–€å®¶ã§ã™ã€‚
ä»¥ä¸‹ã®æƒ…å ±ã‚’åŸºã«ã€${subsidyType}ã®ç”³è«‹æ›¸ã‚’ä½œæˆã—ã¦ãã ã•ã„ã€‚

ä¼æ¥­æƒ…å ±:
${JSON.stringify(companyData, null, 2)}

è¦ä»¶:
${JSON.stringify(requirements, null, 2)}

ä»¥ä¸‹ã®å½¢å¼ã§ç”³è«‹æ›¸ã‚’ç”Ÿæˆã—ã¦ãã ã•ã„:
1. äº‹æ¥­æ¦‚è¦
2. å®Ÿæ–½è¨ˆç”»
3. æœŸå¾…åŠ¹æœ
4. åæ”¯è¨ˆç”»
  `
  
  const result = await geminiModels.text.generateContent(prompt)
  return result.response.text()
}
```

### Phase 4: ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰å®Ÿè£…ï¼ˆ1é€±é–“ï¼‰

#### 4.1 E2Eãƒ†ã‚¹ãƒˆï¼ˆPlaywrightï¼‰
```typescript
// tests/e2e/application-flow.spec.ts
import { test, expect } from '@playwright/test'

test.describe('è£œåŠ©é‡‘ç”³è«‹ãƒ•ãƒ­ãƒ¼', () => {
  test('æŒç¶šåŒ–è£œåŠ©é‡‘ã®ç”³è«‹æ›¸ä½œæˆ', async ({ page }) => {
    // ãƒ­ã‚°ã‚¤ãƒ³
    await page.goto('/auth/login')
    await page.fill('[name="email"]', 'test@example.com')
    await page.fill('[name="password"]', 'password123')
    await page.click('button[type="submit"]')
    
    // ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã¸é·ç§»
    await expect(page).toHaveURL('/dashboard')
    
    // æ–°è¦ç”³è«‹é–‹å§‹
    await page.click('text=æ–°è¦ç”³è«‹')
    await page.selectOption('[name="subsidyType"]', 'sustainability')
    
    // ä¼æ¥­æƒ…å ±å…¥åŠ›
    await page.fill('[name="companyName"]', 'ãƒ†ã‚¹ãƒˆæ ªå¼ä¼šç¤¾')
    await page.fill('[name="corporateNumber"]', '1234567890123')
    
    // AIç”Ÿæˆå®Ÿè¡Œ
    await page.click('text=AIç”³è«‹æ›¸ç”Ÿæˆ')
    await expect(page.locator('.generated-content')).toBeVisible()
    
    // PDFå‡ºåŠ›
    await page.click('text=PDFãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰')
    const [download] = await Promise.all([
      page.waitForEvent('download'),
      page.click('text=ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰é–‹å§‹')
    ])
    
    expect(download.suggestedFilename()).toContain('æŒç¶šåŒ–è£œåŠ©é‡‘_ç”³è«‹æ›¸')
  })
})
```

#### 4.2 APIçµ±åˆãƒ†ã‚¹ãƒˆ
```typescript
// tests/integration/api.test.ts
import { createClient } from '@supabase/supabase-js'

describe('API Integration Tests', () => {
  let supabase: any
  
  beforeAll(() => {
    supabase = createClient(
      process.env.SUPABASE_URL!,
      process.env.SUPABASE_ANON_KEY!
    )
  })
  
  test('ç”³è«‹æ›¸ä½œæˆAPI', async () => {
    const response = await fetch('/api/applications/create', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        subsidyType: 'monozukuri',
        companyData: {
          name: 'ãƒ†ã‚¹ãƒˆè£½é€ æ¥­',
          employees: 50
        }
      })
    })
    
    const data = await response.json()
    expect(data.id).toBeDefined()
    expect(data.status).toBe('draft')
  })
})
```

### Phase 5: æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆ3-4æ—¥ï¼‰

#### 5.1 Vercelè¨­å®š
```json
// vercel.json
{
  "framework": "nextjs",
  "buildCommand": "npm run build",
  "env": {
    "NEXT_PUBLIC_SUPABASE_URL": "@supabase_url",
    "SUPABASE_ANON_KEY": "@supabase_anon_key",
    "GEMINI_API_KEY": "@gemini_api_key"
  },
  "functions": {
    "app/api/applications/create/route.ts": {
      "maxDuration": 60
    }
  }
}
```

#### 5.2 ç’°å¢ƒå¤‰æ•°è¨­å®š
```bash
# .env.production
NEXT_PUBLIC_SUPABASE_URL=https://xxxxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxxxx
SUPABASE_SERVICE_KEY=xxxxx
GEMINI_API_KEY=xxxxx
EGOV_API_KEY=xxxxx
ESTAT_APP_ID=xxxxx
```

## ğŸ“Š ã‚³ã‚¹ãƒˆè¦‹ç©ã‚‚ã‚Š

### æœˆé¡ã‚³ã‚¹ãƒˆï¼ˆ1000ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ³å®šï¼‰
- **Vercel Pro**: $20/æœˆ
- **Supabase Pro**: $25/æœˆ
- **Gemini API**: ç„¡æ–™æ å†…ï¼ˆ60 requests/minuteï¼‰
- **ãã®ä»–API**: å…¨ã¦ç„¡æ–™
- **åˆè¨ˆ**: $45/æœˆï¼ˆç´„6,750å††ï¼‰

## ğŸš€ å®Ÿè£…å„ªå…ˆé †ä½

1. **Week 1**: Supabaseç§»è¡Œ + åŸºæœ¬æ©Ÿèƒ½
2. **Week 2**: å¤–éƒ¨APIé€£æº + å®Ÿãƒ‡ãƒ¼ã‚¿å¯¾å¿œ
3. **Week 3**: Geminiçµ±åˆ + ãƒ†ã‚¹ãƒˆå®Ÿè£…
4. **Week 4**: æœ¬ç•ªãƒ‡ãƒ—ãƒ­ã‚¤ + æœ€çµ‚èª¿æ•´

## âœ… å®Œäº†åŸºæº–

- [ ] å®Ÿéš›ã®è£œåŠ©é‡‘ç”³è«‹æ›¸PDFãŒç”Ÿæˆã§ãã‚‹
- [ ] ä¼æ¥­ã®å®Ÿãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•å–å¾—ã§ãã‚‹
- [ ] 5ã¤ã®è£œåŠ©é‡‘ã™ã¹ã¦ã§ç”³è«‹æ›¸ä½œæˆå¯èƒ½
- [ ] E2Eãƒ†ã‚¹ãƒˆãŒã™ã¹ã¦ãƒ‘ã‚¹
- [ ] Vercelæœ¬ç•ªç’°å¢ƒã§ç¨¼åƒ
- [ ] å®Ÿãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½