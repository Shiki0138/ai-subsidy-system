# フロントエンド開発ルール

## 🛡️ ビルド/デプロイエラー防止ガイドライン

### 1. 環境変数管理
- **必須**: `.env.example`を常に最新に保つ
- **必須**: Vercel環境変数は`vercel env pull`で同期
- **禁止**: APIキーなどの機密情報をコード内にハードコード

### 2. 依存関係管理
- **必須**: `npm`のみ使用（yarn/pnpmは禁止）
- **必須**: `package-lock.json`を必ずコミット
- **推奨**: 依存関係更新は`npm update`で慎重に

### 3. コード品質
- **必須**: コミット前に`npm run build`でローカルビルド確認
- **必須**: TypeScriptの型エラーは0に
- **推奨**: ESLintエラーも0に

### 4. API呼び出し最適化
- **必須**: Gemini APIは軽量プロンプトのみ（<1500文字）
- **推奨**: エラー時は必ずフォールバック実装
- **推奨**: リトライロジックは指数バックオフで

### 5. デプロイ前チェックリスト
```bash
# 1. 環境変数確認
cat .env.example
vercel env pull

# 2. ローカルビルド
npm run build

# 3. 型チェック
npm run type-check

# 4. テスト実行
npm test

# 5. プレビューデプロイ
vercel --prod
```

### 6. エラー発生時の対応
1. エラーログから`E##`番号を特定
2. `Build-error-checklist.md`で対応策確認
3. 修正後は必ずローカルで再現テスト
4. PRでレビュー後にマージ

### 7. Gemini API 503エラー対策
- **即時対応**: テンプレートフォールバックを実装
- **プロンプト**: 1500文字以下に制限
- **リトライ**: 最大5回、待機時間2秒×2^n
- **並列処理**: 避ける（順次処理推奨）

### 8. Git管理
- **必須**: `.gitignore`に`node_modules/`、`.env`を含める
- **禁止**: `dist/`、`.next/`をコミット
- **推奨**: コミットメッセージは`feat:`、`fix:`、`chore:`プレフィックス

### 9. ファイル命名規則
- **必須**: 全て小文字（kebab-case）
- **例**: `business-improvement-ai.ts`
- **禁止**: 大文字混在（PascalCase in filenames）

### 10. 緊急時対応
503エラーが頻発する場合：
1. `business-improvement-ai.ts`の`analyzeAndGenerate`をテンプレートモードに切り替え
2. Vercelに即座にデプロイ
3. ユーザーへの影響を最小化
4. 後日、軽量AI機能を段階的に復活

---
最終更新: 2025-01-15