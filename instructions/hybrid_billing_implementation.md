# ハイブリッド課金モデル実装指示書

**実装期間**: 2025-06-21 〜 2025-07-26（5週間）  
**優先度**: 最高  
**基本方針**: ユーザーファースト - 使いやすさと透明性を最優先

---

## 📋 全体統括事項

### 開発記録の管理
各チームは以下のファイルに開発記録を**毎日**追記すること：

```
/development_logs/
├── team_a_billing_log.md      # チームA: 課金・決済
├── team_b_frontend_log.md     # チームB: フロントエンド
├── team_c_ai_log.md          # チームC: AI・プレビュー
└── team_d_infra_log.md       # チームD: インフラ・監視
```

### 記録フォーマット
```markdown
## 2025-06-21 (担当者名)
### 実施内容
- 実装した機能
- 変更したファイル

### 課題・懸念事項
- 技術的課題
- ユーザビリティの懸念

### 明日の予定
- タスク一覧

### レビュー依頼
- 他チームへの確認事項
```

---

## 🏆 チームA: 課金・決済基盤

**リーダー**: 決済システム経験者  
**期間**: Week 1-3

### 実装タスク

#### 1. Stripe統合（Week 1）
```python
# 実装ファイル
/ai-engine/src/services/stripe_service.py
/ai-engine/src/api/billing_endpoints.py

# 必須機能
- Checkout Session作成
- Webhook処理（署名検証含む）
- 顧客管理（Customer作成・更新）
- エラーハンドリング（決済失敗、タイムアウト）
```

**ユーザーファースト要件**:
- 決済エラー時の分かりやすいメッセージ
- 再試行の案内（具体的な手順付き）
- 決済状況のリアルタイム更新

#### 2. 価格管理システム（Week 2）
```python
# 価格設定（ユーザーに優しい価格体系）
PRICING = {
    "first_time": {
        "amount": 1980,
        "message": "初回限定50%オフ！お試し価格"
    },
    "regular": {
        "amount": 3980,
        "message": "通常価格"
    },
    "bulk_3": {
        "amount": 9800,
        "message": "3回分パック（2,140円お得）",
        "unit_price": 3267
    }
}
```

#### 3. 返金・キャンセル処理（Week 3）
```python
# ユーザー保護機能
- 24時間以内の無条件キャンセル
- システムエラー時の自動返金
- 返金理由の記録（サービス改善用）
```

### デリバラブル
- [ ] Stripe商品・価格設定完了
- [ ] 決済APIドキュメント
- [ ] エラー処理フローチャート
- [ ] 返金ポリシー文書

---

## 🎨 チームB: フロントエンド・UX

**リーダー**: UXデザイナー  
**期間**: Week 2-4

### 実装タスク

#### 1. 決済フローUI（Week 2）
```typescript
// 実装コンポーネント
/frontend/components/billing/
├── PricingCard.tsx        // 価格表示（分かりやすく）
├── CheckoutModal.tsx      // 決済モーダル（シンプルに）
├── PaymentStatus.tsx      // 進捗表示（安心感を）
└── SuccessAnimation.tsx   // 成功体験の演出

// ユーザビリティ要件
- 価格の透明性（隠れた費用なし）
- ワンクリック決済
- 進捗の可視化
- 成功時の喜びの演出
```

#### 2. プレビュー画面（Week 3）
```typescript
// プレビュー機能
- 品質スコアの視覚的表示
- サンプルページの美しい表示
- 購入メリットの明確な提示
- 「なぜ有料か」の説明

// 信頼構築要素
- お客様の声
- 採択実績
- 品質保証の説明
```

#### 3. アップセル最適化（Week 4）
```typescript
// タイミング制御
const UPSELL_TRIGGERS = {
  afterSecondPurchase: {
    delay: 0,
    message: "よく利用される方へ：月額プランで最大60%お得に"
  },
  highQualityScore: {
    delay: 3000,
    message: "素晴らしい申請書です！継続的なサポートはいかがですか？"
  }
}

// 押し付けがましくない提案
- 閉じやすいバナー
- 「今回は結構です」オプション
- 次回まで非表示設定
```

### デリバラブル
- [ ] Figmaデザイン完成
- [ ] コンポーネントライブラリ
- [ ] A/Bテスト設定
- [ ] アクセシビリティチェック

---

## 🤖 チームC: AI・品質保証

**リーダー**: AIエンジニア  
**期間**: Week 1-2

### 実装タスク

#### 1. プレビュー生成の最適化（Week 1）
```python
# 改善点
/ai-engine/src/services/pdf_preview_service.py

# 品質指標の精度向上
- 過去の採択データを学習
- リアルタイムスコアリング
- 改善提案の自動生成

# ユーザー価値
- 「なぜこのスコアか」の説明
- 具体的な改善アドバイス
- 競合比較（匿名化済み）
```

#### 2. 文書品質の向上（Week 2）
```python
# 新機能：品質保証システム
- 自動文法チェック
- 専門用語の適切性確認
- 論理構造の検証
- 説得力スコア

# ユーザーメリット明示
quality_benefits = {
    "grammar_check": "誤字脱字ゼロを保証",
    "term_check": "審査員に伝わる適切な表現",
    "logic_check": "論理的で説得力のある構成",
    "score": "採択可能性を最大化"
}
```

### デリバラブル
- [ ] 品質スコアリングモデル
- [ ] プレビューAPI最適化
- [ ] 品質改善提案システム
- [ ] ユーザー向け品質説明書

---

## 🔧 チームD: インフラ・監視

**リーダー**: SREエンジニア  
**期間**: Week 1-5（継続）

### 実装タスク

#### 1. 決済システムの信頼性（Week 1-2）
```yaml
# 監視設定
monitoring:
  - payment_success_rate:
      threshold: 99.5%
      alert: immediate
  - payment_latency:
      threshold: 3s
      alert: warning
  - webhook_processing:
      threshold: 99.9%
      alert: critical

# ユーザー影響の最小化
- 決済タイムアウト: 30秒
- 自動リトライ: 3回
- フォールバック決済手段
```

#### 2. スケーラビリティ（Week 3）
```yaml
# Auto Scaling設定
pdf_generation:
  min_instances: 2
  max_instances: 10
  target_cpu: 60%
  
payment_api:
  min_instances: 3
  max_instances: 20
  target_latency: 200ms

# ユーザー体験の保証
- ピーク時も3秒以内で応答
- 同時1000件の決済処理
- 99.9%の可用性
```

#### 3. セキュリティ・コンプライアンス（Week 4-5）
```yaml
# セキュリティ要件
security:
  - PCI DSS準拠
  - 決済情報の非保持
  - エンドツーエンド暗号化
  - 監査ログの完全性

# ユーザー保護
- 個人情報の最小限収集
- データ削除権の保証
- 透明性レポート月次公開
```

### デリバラブル
- [ ] インフラ構成図
- [ ] 監視ダッシュボード
- [ ] 災害復旧計画書
- [ ] セキュリティ監査報告

---

## 📊 週次進捗管理

### Week 1 (6/21-6/27)
```markdown
## マイルストーン
- [ ] チームA: Stripe環境構築完了
- [ ] チームC: プレビュー機能改善完了
- [ ] チームD: 監視基盤構築完了

## デモ内容
- プレビュー → 決済 → ダウンロードの基本フロー
```

### Week 2 (6/28-7/4)
```markdown
## マイルストーン
- [ ] チームA: 価格管理システム完成
- [ ] チームB: 決済UI実装完了
- [ ] チームD: 負荷テスト実施

## デモ内容
- 完全な決済フロー（エラー処理含む）
```

### Week 3 (7/5-7/11)
```markdown
## マイルストーン
- [ ] チームA: 返金システム完成
- [ ] チームB: プレビュー画面完成
- [ ] チームC: 品質向上システム統合

## デモ内容
- エンドツーエンドのユーザー体験
```

### Week 4 (7/12-7/18)
```markdown
## マイルストーン
- [ ] チームB: アップセル機能完成
- [ ] チームD: セキュリティ監査完了
- [ ] 全チーム: 統合テスト

## デモ内容
- 本番相当環境でのフルフロー
```

### Week 5 (7/19-7/26)
```markdown
## マイルストーン
- [ ] 全チーム: バグ修正・最適化
- [ ] 本番リリース準備
- [ ] ドキュメント完成

## リリース判定会議
- 7/25 最終確認
- 7/26 本番リリース
```

---

## 📝 overview.md 更新項目

### 追加すべきセクション
```markdown
## 料金体系
- 初回限定: ¥1,980
- 通常価格: ¥3,980
- まとめ買い: 3回¥9,800 / 5回¥14,800
- サブスクリプション: Growth ¥9,800/月, Scale ¥29,800/月

## ユーザー保護
- 24時間キャンセル可能
- SSL暗号化通信
- PCI DSS準拠
- 個人情報最小限収集

## 品質保証
- AIによる品質スコアリング
- プレビューで事前確認可能
- 専門家による定期レビュー
- 採択率実績の公開
```

---

## 🚨 重要な注意事項

1. **ユーザーファースト厳守**
   - 隠れた費用は絶対NG
   - エラーメッセージは優しく具体的に
   - 不要な個人情報は収集しない

2. **透明性の確保**
   - 価格は常に明確に表示
   - 利用規約は平易な言葉で
   - 返金ポリシーは分かりやすく

3. **継続的改善**
   - ユーザーフィードバックを毎週レビュー
   - A/Bテストで最適化
   - 満足度調査の実施

4. **チーム間連携**
   - 毎日15分のスタンドアップ
   - 週次の進捗共有会
   - Slackでの即時連携

---

**作成日**: 2025-06-20  
**作成者**: プロジェクトマネージャー  
**次回レビュー**: 2025-06-27

各チームリーダーは、この指示書を確認後、詳細なタスク分解を行い、チームメンバーに展開してください。